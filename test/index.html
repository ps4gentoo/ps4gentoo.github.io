<html manifest="index.cache">
<head>
<title>PS-Phive! (FOR PS4 FW v7.00 to v9.60) v1.0 By Leeful, Ported by Sinajet</title>
<style>
html{margin:0px;height:100%;}
body{background-color:#1849A5;background:url("files/img/BG.jpg");background-size:cover;background-repeat:no-repeat;color:#DDE5EA;font-family:sans-serif;font-size:22px;overflow:hidden;cursor:none;margin:0px;height:100%;}
.Loader{background-color:transparent;transition:opacity 1000ms;opacity:0;}

/* Modern Overlay Styles */
.overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(10, 25, 50, 0.85);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  transition: opacity 0.5s ease;
}

.overlay.hidden {
  opacity: 0;
  pointer-events: none;
}

.overlay-content {
  text-align: center;
  max-width: 80%;
}

.overlay-title {
  color: #fff;
  font-size: 32px;
  margin-bottom: 30px;
  text-shadow: 0 2px 4px rgba(0,0,0,0.5);
}

.overlay-progress-container {
  width: 100%;
  max-width: 500px;
  margin: 0 auto 25px;
}

.overlay-progress-bar {
  height: 24px;
  background: rgba(0, 0, 0, 0.4);
  border-radius: 12px;
  overflow: hidden;
  box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.5);
}

.overlay-progress-fill {
  height: 100%;
  width: 0%;
  background: linear-gradient(to right, #1e5799, #2989d8, #18A5FF);
  border-radius: 12px;
  transition: width 0.3s ease;
}

.overlay-status {
  color: #fff;
  font-size: 20px;
  margin: 20px 0;
  min-height: 30px;
}

.overlay-percent {
  color: #18A5FF;
  font-weight: bold;
  font-size: 24px;
  margin-top: 15px;
}

.overlay-message {
  color: #A0C0E0;
  font-size: 18px;
  margin-top: 10px;
  font-style: italic;
}
</style>
<script>
// Initialize localStorage values
if (localStorage.length == 0) {
    if (localStorage.GHver == null){localStorage.GHver = "v2.4b18.5";}
    if (localStorage.autoGH == null){localStorage.autoGH = "OFF";}
    if (localStorage.passcount == null){localStorage.passcount=0;}
    if (localStorage.failcount == null){localStorage.failcount=0;}
    // Initialize cache status in localStorage if not exists
    if (localStorage.cacheStatus == null){localStorage.cacheStatus = "uncached";}
}

// Create modern overlay
function createOverlay() {
    const overlay = document.createElement('div');
    overlay.id = 'cacheOverlay';
    overlay.className = 'overlay';
    overlay.innerHTML = `
        <div class="overlay-content">
            <div class="overlay-title">PS-Phive Cache Installation</div>
            <div class="overlay-progress-container">
                <div class="overlay-progress-bar">
                    <div class="overlay-progress-fill" id="progressFill"></div>
                </div>
            </div>
            <div class="overlay-percent" id="progressPercent">0%</div>
            <div class="overlay-status" id="progressStatus">Initializing...</div>
            <div class="overlay-message" id="progressMessage">Preparing cache installation</div>
        </div>
    `;
    document.body.appendChild(overlay);
    return overlay;
}

// Update progress function
function updateProgress(percent, status, message) {
    const progressFill = document.getElementById('progressFill');
    const progressPercent = document.getElementById('progressPercent');
    const progressStatus = document.getElementById('progressStatus');
    const progressMessage = document.getElementById('progressMessage');
    
    if (progressFill) progressFill.style.width = percent + '%';
    if (progressPercent) progressPercent.textContent = percent + '%';
    if (progressStatus) progressStatus.textContent = status;
    if (progressMessage) progressMessage.textContent = message;
}

// Handle cache installation with real progress
function handleCacheInstallation() {
    const overlay = createOverlay();
    const appCache = window.applicationCache;
    
    // Setup event listeners for real progress tracking
    appCache.addEventListener('checking', function(e) {
        updateProgress(5, "Checking", "Verifying cache status...");
    }, false);
    
    appCache.addEventListener('downloading', function(e) {
        updateProgress(10, "Downloading", "Starting cache download...");
    }, false);
    
    appCache.addEventListener('progress', function(e) {
        if (e.loaded && e.total) {
            // Calculate progress (10% to 90% during download)
            const percent = 10 + Math.round((e.loaded / e.total) * 80);
            updateProgress(
                percent, 
                "Downloading", 
                `File ${e.loaded} of ${e.total}`
            );
        }
    }, false);
    
    appCache.addEventListener('cached', function(e) {
        updateProgress(100, "Complete", "Cache installed successfully!");
        localStorage.cacheStatus = "cached";
        setTimeout(function() {
            overlay.classList.add('hidden');
            setTimeout(function() {
                location.reload(true);
            }, 500);
        }, 1000);
    }, false);
    
    appCache.addEventListener('updateready', function(e) {
        updateProgress(100, "Complete", "Cache updated successfully!");
        localStorage.cacheStatus = "cached";
        setTimeout(function() {
            overlay.classList.add('hidden');
            setTimeout(function() {
                location.reload(true);
            }, 500);
        }, 1000);
    }, false);
    
    appCache.addEventListener('error', function(e) {
        updateProgress(0, "Error", "Cache installation failed. Loading menu...");
        setTimeout(function() {
            overlay.classList.add('hidden');
            JBalreadyDone();
        }, 2000);
    }, false);
    
    appCache.addEventListener('noupdate', function(e) {
        updateProgress(100, "Complete", "Cache is up to date!");
        localStorage.cacheStatus = "cached";
        setTimeout(function() {
            overlay.classList.add('hidden');
            JBalreadyDone();
        }, 1000);
    }, false);
    
    // Start the cache update process
    try {
        appCache.update();
    } catch(e) {
        updateProgress(0, "Error", "Cache initialization error. Loading menu...");
        setTimeout(function() {
            overlay.classList.add('hidden');
            JBalreadyDone();
        }, 2000);
    }
}

function go(){
    // Check cache status
    if (localStorage.cacheStatus == "uncached" || localStorage.cacheStatus == null){
        handleCacheInstallation();
    } else {
        ShowMenu();  
    }
}
</script>
</head>
<body onload="go()">
<div id=Loader class=Loader></div>

<script>
function ShowMenu(){
    const existingOverlay = document.getElementById('cacheOverlay');
    if (existingOverlay) {
        existingOverlay.classList.add('hidden');
    }
    Loader.innerHTML = '<iframe id="mymenu" src="files/menu.html" style="width:100%; height:100%; background-color:transparent; border: none;"></iframe>';
    setTimeout(function(){Loader.style.opacity="1";},100);
}
</script>

</body>
</html>